# ==============================================================================
# Redis 8 Configuration for Laravel Development
# ==============================================================================

# Bind to all interfaces (dentro do Docker)
bind 0.0.0.0

# Porta padrão
port 6379

# Proteção de acesso (desabilitado para dev local)
protected-mode no

# Persistência
appendonly yes
appendfsync everysec
appendfilename "appendonly.aof"

# RDB Snapshots
save 900 1
save 300 10
save 60 10000
dbfilename dump.rdb

# Diretório de dados
dir /data

# Memória máxima (ajuste conforme necessário)
maxmemory 256mb
maxmemory-policy allkeys-lru

# Logging
loglevel notice
# logfile ""

# Conexões
maxclients 10000
tcp-keepalive 300
timeout 0

# Performance
tcp-backlog 511
databases 16

# Lazy freeing (melhora performance em deletes grandes)
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# Threading (Redis 8 suporta I/O threading)
io-threads 4
io-threads-do-reads yes

# Active defragmentation
activedefrag yes
active-defrag-ignore-bytes 100mb
active-defrag-threshold-lower 10
active-defrag-threshold-upper 50

# Client output buffer limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Slow log
slowlog-log-slower-than 10000
slowlog-max-len 128
