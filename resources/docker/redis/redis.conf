# ==============================================================================
# Redis 8 Configuration for Laravel Development
# ==============================================================================

# Bind to all interfaces (inside Docker)
bind 0.0.0.0

# Default port
port 6379

# Access protection (disabled for local dev)
protected-mode no

# Persistence
appendonly yes
appendfsync everysec
appendfilename "appendonly.aof"

# RDB Snapshots
save 900 1
save 300 10
save 60 10000
dbfilename dump.rdb

# Data directory
dir /data

# Maximum memory (adjust as needed)
maxmemory 256mb
maxmemory-policy allkeys-lru

# Logging
loglevel notice

# Connections
maxclients 10000
tcp-keepalive 300
timeout 0

# Performance
tcp-backlog 511
databases 16

# Lazy freeing (improves performance on large deletes)
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# Threading (Redis 8 supports I/O threading)
io-threads 4
io-threads-do-reads yes

# Active defragmentation
activedefrag yes
active-defrag-ignore-bytes 100mb
active-defrag-threshold-lower 10
active-defrag-threshold-upper 50

# Client output buffer limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Slow log
slowlog-log-slower-than 10000
slowlog-max-len 128
